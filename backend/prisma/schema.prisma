generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model User {
  id                       String                  @id @default(cuid())
  email                    String                  @unique
  name                     String?
  profilePhoto             String?
  birthday                 DateTime?
  createdAt                DateTime                @default(now())
  updatedAt                DateTime                @updatedAt
  isAdmin                  Boolean                 @default(false)
  workout_imports          WorkoutImport[]
  workoutLogs              WorkoutLog[]
  workout_personal_records WorkoutPersonalRecord[]
  workout_plan_templates   WorkoutPlanTemplate[]
  workoutPlans             WorkoutPlan[]
  createdWorkouts          Workout[]               @relation("WorkoutCreator")
  personalRecordEntries    PersonalRecordEntry[]
  userRepConfigs           UserWorkoutRepConfig[]

  @@map("users")
}

model Workout {
  id                       String                  @id @default(cuid())
  title                    String
  category                 String
  description              String?
  workoutType              String
  sets                     Int?
  reps                     Int?
  duration                 Int?
  intensity                String
  imageUrl                 String?
  isGlobal                 Boolean                 @default(true)
  createdBy                String?
  createdAt                DateTime                @default(now())
  updatedAt                DateTime                @updatedAt
  imageUrl2                String?                 @map("imageUrl2")
  trackRecords             Boolean                 @default(false)
  intensityModel           String                  @default("legacy")
  defaultPreset            String?
  durationPerSet           Int?
  sourceUrl                String?
  sourcePlatform           String?
  planItems                PlanItem[]
  workoutLogs              WorkoutLog[]
  workout_personal_records WorkoutPersonalRecord[]
  personalRecordEntries    PersonalRecordEntry[]
  userRepConfigs           UserWorkoutRepConfig[]
  creator                  User?                   @relation("WorkoutCreator", fields: [createdBy], references: [id])

  @@map("workouts")
}

model WorkoutPlan {
  id        String     @id @default(cuid())
  name      String
  startDate DateTime
  endDate   DateTime
  userId    String
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
  planItems PlanItem[]
  user      User       @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("workout_plans")
}

model PlanItem {
  id            String      @id @default(cuid())
  workoutId     String
  workoutPlanId String
  intensity     String?
  scheduledDate DateTime    @map("scheduled_date")
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
  workout       Workout     @relation(fields: [workoutId], references: [id], onDelete: Cascade)
  workoutPlan   WorkoutPlan @relation(fields: [workoutPlanId], references: [id], onDelete: Cascade)

  @@map("plan_items")
}

model WorkoutLog {
  id        String   @id @default(cuid())
  workoutId String
  userId    String
  date      DateTime
  sets      Int?
  reps      Int?
  duration  Int?
  weight    Float?
  rpe       Int?
  pace      String?
  heartRate Int?
  notes     String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  workout   Workout  @relation(fields: [workoutId], references: [id], onDelete: Cascade)

  @@map("workout_logs")
}

model WorkoutPersonalRecord {
  id         String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id    String
  workout_id String
  value      String
  created_at DateTime @default(now()) @db.Timestamptz(6)
  updated_at DateTime @default(now()) @db.Timestamptz(6)
  users      User     @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  workouts   Workout  @relation(fields: [workout_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([user_id, workout_id], map: "workout_personal_records_user_workout_key")
  @@map("workout_personal_records")
}

model WorkoutImport {
  id              String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id         String
  source_url      String
  source_platform String?
  title           String?
  category        String?
  description     String?
  thumbnail_url   String?
  metadata        Json?
  is_global       Boolean  @default(false)
  created_at      DateTime @default(now()) @db.Timestamptz(6)
  updated_at      DateTime @default(now()) @db.Timestamptz(6)
  html            String?
  users           User     @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([source_platform], map: "idx_workout_import_source_platform")
  @@index([user_id], map: "idx_workout_import_user_id")
  @@map("workout_imports")
}

model WorkoutPlanTemplate {
  id                String   @id @default(cuid())
  name              String
  description       String?
  num_weeks         Int
  days_per_week     Int
  workout_structure Json
  level             String?
  created_by        String?
  created_at        DateTime @default(now()) @db.Timestamptz(6)
  updated_at        DateTime @default(now()) @db.Timestamptz(6)
  users             User?    @relation(fields: [created_by], references: [id], onUpdate: NoAction)

  @@map("workout_plan_templates")
}

model PersonalRecordEntry {
  id           String   @id @default(cuid())
  userId       String
  workoutId    String
  reps         Int
  weight       Float
  dateAchieved DateTime @default(now())
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  user    User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  workout Workout @relation(fields: [workoutId], references: [id], onDelete: Cascade)

  @@index([userId, workoutId, reps])
  @@map("personal_record_entries")
}

model UserWorkoutRepConfig {
  id         String   @id @default(cuid())
  userId     String
  workoutId  String
  customReps Int[]
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  user    User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  workout Workout @relation(fields: [workoutId], references: [id], onDelete: Cascade)

  @@unique([userId, workoutId])
  @@map("user_workout_rep_configs")
}
